# Data Models: RAG Chatbot Backend

This document defines the data structures for the RAG Chatbot Backend.

## 1. ChatInteraction (PostgreSQL)

Represents a single user-AI conversation turn logged for auditing and analysis. This model will be mapped to a table in the Neon Serverless Postgres database.

| Field | Data Type | Constraints | Description |
|---|---|---|---|
| `id` | `BIGINT` | Primary Key, Auto-incrementing | Unique identifier for the log entry. |
| `user_message` | `TEXT` | Not Null | The full message sent by the user. |
| `ai_response` | `TEXT` | Not Null | The full response generated by the AI. |
| `timestamp` | `TIMESTAMPTZ` | Not Null, Default: `NOW()` | The UTC timestamp when the interaction was logged. |
| `source_documents`| `JSONB` | Nullable | Metadata of the source document chunks used for the response. |

## 2. Qdrant Vector Schema

This describes the structure of the vectors to be stored in the Qdrant vector database. The collection will be named `textbook_embeddings`.

-   **Vector Size**: 1536 (for `text-embedding-3-small`)
-   **Distance Metric**: Cosine

### Payload Fields

The payload associated with each vector will contain the following metadata:

| Field | Data Type | Description |
|---|---|---|
| `text` | `string` | The actual text chunk corresponding to the vector. |
| `source_file` | `string` | The path to the original markdown file from which the chunk was extracted. |
| `chunk_hash` | `string` | An MD5 hash of the chunk's text content, used for simple de-duplication. |

## 3. API Data Contracts

These Pydantic models define the shape of the data for API requests and responses.

### ChatRequest

`POST /api/chat`

```python
from pydantic import BaseModel, Field
from typing import List

class ChatRequest(BaseModel):
    message: str = Field(..., max_length=5000, description="The user's chat message.")
    history: List[dict] = Field([], description="A list of previous conversation turns.")
```
