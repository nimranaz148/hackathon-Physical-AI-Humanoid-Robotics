openapi: 3.0.3
info:
  title: RAG Chatbot Backend API
  version: 1.0.0
  description: API for the Physical AI textbook chatbot.
servers:
  - url: http://localhost:8000
    description: Local development server

components:
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key

security:
  - ApiKeyAuth: []

paths:
  /api/chat:
    post:
      summary: "Handle a chat message"
      operationId: "chat_api_chat_post"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ChatRequest"
      responses:
        "200":
          description: "Successful streaming response"
          content:
            text/event-stream:
              schema:
                type: string
        "422":
          description: "Validation Error"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"

  /ingest:
    post:
      summary: "Trigger the document ingestion process"
      operationId: "ingest_ingest_post"
      responses:
        "200":
          description: "Ingestion process started successfully"
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Ingestion process started."

components:
  schemas:
    ChatRequest:
      title: "ChatRequest"
      required:
        - message
      type: "object"
      properties:
        message:
          title: "Message"
          type: "string"
          maxLength: 5000
          description: "The user's chat message."
        history:
          title: "History"
          type: "array"
          items:
            type: "object"
          description: "A list of previous conversation turns."
    HTTPValidationError:
      title: "HTTPValidationError"
      type: "object"
      properties:
        detail:
          title: "Detail"
          type: "array"
          items:
            $ref: "#/components/schemas/ValidationError"
    ValidationError:
      title: "ValidationError"
      required:
        - loc
        - msg
        - type
      type: "object"
      properties:
        loc:
          title: "Location"
          type: "array"
          items:
            anyOf:
              - type: "string"
              - type: "integer"
        msg:
          title: "Message"
          type: "string"
        type:
          title: "Error Type"
          type: "string"
