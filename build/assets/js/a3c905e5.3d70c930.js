"use strict";(globalThis.webpackChunkphysical_ai_textbook=globalThis.webpackChunkphysical_ai_textbook||[]).push([[848],{8035(e,n,r){r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>i,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"module1/week4-ros-fundamentals-2","title":"ROS 2 Communication Patterns","description":"Services, actions, and advanced communication patterns for robot control","source":"@site/docs/module1/week4-ros-fundamentals-2.md","sourceDirName":"module1","slug":"/module1/week4-ros-fundamentals-2","permalink":"/physical-ai-and-humanoid-robotics/docs/module1/week4-ros-fundamentals-2","draft":false,"unlisted":false,"editUrl":"https://github.com/nimranaz148/docs/module1/week4-ros-fundamentals-2.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4,"title":"ROS 2 Communication Patterns","description":"Services, actions, and advanced communication patterns for robot control","keywords":["ros2","services","actions","communication","rclpy"]},"sidebar":"tutorialSidebar","previous":{"title":"ROS 2 Architecture","permalink":"/physical-ai-and-humanoid-robotics/docs/module1/week3-ros-fundamentals"},"next":{"title":"ROS 2 Packages and Launch Files","permalink":"/physical-ai-and-humanoid-robotics/docs/module1/week5-ros-fundamentals-3"}}');var s=r(4848),o=r(8453);const i={sidebar_position:4,title:"ROS 2 Communication Patterns",description:"Services, actions, and advanced communication patterns for robot control",keywords:["ros2","services","actions","communication","rclpy"]},a="Week 4: ROS 2 Communication Patterns",l={},c=[{value:"Learning Outcomes",id:"learning-outcomes",level:2},{value:"The Physics (Why)",id:"the-physics-why",level:2},{value:"The Analogy (Mental Model)",id:"the-analogy-mental-model",level:2},{value:"The Visualization (Communication Patterns)",id:"the-visualization-communication-patterns",level:2},{value:"The Code (Implementation)",id:"the-code-implementation",level:2},{value:"Service Server",id:"service-server",level:3},{value:"Service Client",id:"service-client",level:3},{value:"Action Server (Navigation Example)",id:"action-server-navigation-example",level:3},{value:"The Hardware Reality (Warning)",id:"the-hardware-reality-warning",level:2},{value:"Assessment",id:"assessment",level:2},{value:"Recall",id:"recall",level:3},{value:"Apply",id:"apply",level:3},{value:"Analyze",id:"analyze",level:3}];function d(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"week-4-ros-2-communication-patterns",children:"Week 4: ROS 2 Communication Patterns"})}),"\n",(0,s.jsx)(n.h2,{id:"learning-outcomes",children:"Learning Outcomes"}),"\n",(0,s.jsx)(n.p,{children:"By the end of this chapter, you should be able to:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Implement ROS 2 services for request-response communication"}),"\n",(0,s.jsx)(n.li,{children:"Use actions for long-running tasks with feedback"}),"\n",(0,s.jsx)(n.li,{children:"Choose the appropriate communication pattern for different scenarios"}),"\n",(0,s.jsx)(n.li,{children:"Handle errors and timeouts in ROS 2 communication"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"the-physics-why",children:"The Physics (Why)"}),"\n",(0,s.jsx)(n.p,{children:"Topics work well for continuous data streams, but robots also need:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Request-response"}),': "What is the current battery level?" \u2192 "85%"']}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Long-running tasks"}),': "Navigate to the kitchen" \u2192 progress updates \u2192 "Arrived"']}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Cancellable operations"}),': "Stop moving!" during navigation']}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["ROS 2 provides ",(0,s.jsx)(n.strong,{children:"Services"})," and ",(0,s.jsx)(n.strong,{children:"Actions"})," for these patterns."]}),"\n",(0,s.jsx)(n.h2,{id:"the-analogy-mental-model",children:"The Analogy (Mental Model)"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Pattern"}),(0,s.jsx)(n.th,{children:"Real-World Analogy"}),(0,s.jsx)(n.th,{children:"Use Case"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Topic"})}),(0,s.jsx)(n.td,{children:"Radio broadcast"}),(0,s.jsx)(n.td,{children:"Sensor data, continuous streams"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Service"})}),(0,s.jsx)(n.td,{children:"Phone call"}),(0,s.jsx)(n.td,{children:"Quick queries, configuration"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Action"})}),(0,s.jsx)(n.td,{children:"Food delivery app"}),(0,s.jsx)(n.td,{children:"Long tasks with tracking"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"the-visualization-communication-patterns",children:"The Visualization (Communication Patterns)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-mermaid",children:"sequenceDiagram\r\n    participant C as Client\r\n    participant S as Server\r\n    \r\n    Note over C,S: Service Pattern\r\n    C->>S: Request\r\n    S->>C: Response\r\n    \r\n    Note over C,S: Action Pattern\r\n    C->>S: Goal\r\n    S->>C: Feedback\r\n    S->>C: Feedback\r\n    S->>C: Result\n"})}),"\n",(0,s.jsx)(n.h2,{id:"the-code-implementation",children:"The Code (Implementation)"}),"\n",(0,s.jsx)(n.h3,{id:"service-server",children:"Service Server"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'#!/usr/bin/env python3\r\n"""\r\nService server for robot configuration queries.\r\n"""\r\n\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom std_srvs.srv import SetBool, Trigger\r\nfrom example_interfaces.srv import AddTwoInts\r\n\r\n\r\nclass RobotConfigService(Node):\r\n    """Provides configuration services for the robot."""\r\n    \r\n    def __init__(self):\r\n        super().__init__(\'robot_config_service\')\r\n        \r\n        # Service to enable/disable motors\r\n        self.motor_srv = self.create_service(\r\n            SetBool,\r\n            \'/robot/enable_motors\',\r\n            self.enable_motors_callback\r\n        )\r\n        \r\n        # Service to get robot status\r\n        self.status_srv = self.create_service(\r\n            Trigger,\r\n            \'/robot/get_status\',\r\n            self.get_status_callback\r\n        )\r\n        \r\n        self.motors_enabled = False\r\n        self.get_logger().info(\'Robot config service ready\')\r\n    \r\n    def enable_motors_callback(\r\n        self,\r\n        request: SetBool.Request,\r\n        response: SetBool.Response\r\n    ) -> SetBool.Response:\r\n        """Handle motor enable/disable requests."""\r\n        self.motors_enabled = request.data\r\n        \r\n        response.success = True\r\n        response.message = (\r\n            \'Motors enabled\' if self.motors_enabled else \'Motors disabled\'\r\n        )\r\n        \r\n        self.get_logger().info(response.message)\r\n        return response\r\n    \r\n    def get_status_callback(\r\n        self,\r\n        request: Trigger.Request,\r\n        response: Trigger.Response\r\n    ) -> Trigger.Response:\r\n        """Return current robot status."""\r\n        response.success = True\r\n        response.message = f\'Motors: {"ON" if self.motors_enabled else "OFF"}\'\r\n        return response\r\n\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    node = RobotConfigService()\r\n    rclpy.spin(node)\r\n    node.destroy_node()\r\n    rclpy.shutdown()\r\n\r\n\r\nif __name__ == \'__main__\':\r\n    main()\n'})}),"\n",(0,s.jsx)(n.h3,{id:"service-client",children:"Service Client"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'#!/usr/bin/env python3\r\n"""\r\nService client demonstrating synchronous and async calls.\r\n"""\r\n\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom std_srvs.srv import SetBool, Trigger\r\n\r\n\r\nclass RobotController(Node):\r\n    """Controls robot via services."""\r\n    \r\n    def __init__(self):\r\n        super().__init__(\'robot_controller\')\r\n        \r\n        # Create service clients\r\n        self.motor_client = self.create_client(\r\n            SetBool,\r\n            \'/robot/enable_motors\'\r\n        )\r\n        \r\n        self.status_client = self.create_client(\r\n            Trigger,\r\n            \'/robot/get_status\'\r\n        )\r\n        \r\n        # Wait for services to be available\r\n        while not self.motor_client.wait_for_service(timeout_sec=1.0):\r\n            self.get_logger().info(\'Waiting for motor service...\')\r\n    \r\n    def enable_motors(self, enable: bool) -> bool:\r\n        """Enable or disable motors (blocking call)."""\r\n        request = SetBool.Request()\r\n        request.data = enable\r\n        \r\n        future = self.motor_client.call_async(request)\r\n        rclpy.spin_until_future_complete(self, future)\r\n        \r\n        result = future.result()\r\n        self.get_logger().info(f\'Motor service: {result.message}\')\r\n        return result.success\r\n    \r\n    def get_status(self) -> str:\r\n        """Get robot status."""\r\n        request = Trigger.Request()\r\n        future = self.status_client.call_async(request)\r\n        rclpy.spin_until_future_complete(self, future)\r\n        return future.result().message\r\n\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    controller = RobotController()\r\n    \r\n    # Enable motors\r\n    controller.enable_motors(True)\r\n    \r\n    # Check status\r\n    status = controller.get_status()\r\n    print(f\'Robot status: {status}\')\r\n    \r\n    controller.destroy_node()\r\n    rclpy.shutdown()\r\n\r\n\r\nif __name__ == \'__main__\':\r\n    main()\n'})}),"\n",(0,s.jsx)(n.h3,{id:"action-server-navigation-example",children:"Action Server (Navigation Example)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'#!/usr/bin/env python3\r\n"""\r\nAction server for robot navigation with progress feedback.\r\n"""\r\n\r\nimport time\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom rclpy.action import ActionServer, GoalResponse, CancelResponse\r\nfrom rclpy.action.server import ServerGoalHandle\r\nfrom example_interfaces.action import Fibonacci  # Using as placeholder\r\n\r\n\r\nclass NavigationServer(Node):\r\n    """Handles navigation goals with feedback."""\r\n    \r\n    def __init__(self):\r\n        super().__init__(\'navigation_server\')\r\n        \r\n        self._action_server = ActionServer(\r\n            self,\r\n            Fibonacci,  # In real code: NavigateToPose\r\n            \'navigate\',\r\n            execute_callback=self.execute_callback,\r\n            goal_callback=self.goal_callback,\r\n            cancel_callback=self.cancel_callback\r\n        )\r\n        \r\n        self.get_logger().info(\'Navigation server ready\')\r\n    \r\n    def goal_callback(self, goal_request) -> GoalResponse:\r\n        """Accept or reject incoming goals."""\r\n        self.get_logger().info(\'Received navigation goal\')\r\n        return GoalResponse.ACCEPT\r\n    \r\n    def cancel_callback(self, goal_handle: ServerGoalHandle) -> CancelResponse:\r\n        """Handle cancellation requests."""\r\n        self.get_logger().info(\'Received cancel request\')\r\n        return CancelResponse.ACCEPT\r\n    \r\n    async def execute_callback(\r\n        self,\r\n        goal_handle: ServerGoalHandle\r\n    ) -> Fibonacci.Result:\r\n        """Execute the navigation goal with feedback."""\r\n        self.get_logger().info(\'Executing navigation...\')\r\n        \r\n        feedback_msg = Fibonacci.Feedback()\r\n        \r\n        # Simulate navigation progress\r\n        for i in range(10):\r\n            if goal_handle.is_cancel_requested:\r\n                goal_handle.canceled()\r\n                self.get_logger().info(\'Navigation canceled\')\r\n                return Fibonacci.Result()\r\n            \r\n            # Send progress feedback\r\n            feedback_msg.partial_sequence = [i * 10]  # % complete\r\n            goal_handle.publish_feedback(feedback_msg)\r\n            self.get_logger().info(f\'Progress: {i * 10}%\')\r\n            \r\n            time.sleep(0.5)  # Simulate movement\r\n        \r\n        goal_handle.succeed()\r\n        \r\n        result = Fibonacci.Result()\r\n        result.sequence = [100]  # Complete\r\n        return result\r\n\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    node = NavigationServer()\r\n    rclpy.spin(node)\r\n    node.destroy_node()\r\n    rclpy.shutdown()\r\n\r\n\r\nif __name__ == \'__main__\':\r\n    main()\n'})}),"\n",(0,s.jsx)(n.h2,{id:"the-hardware-reality-warning",children:"The Hardware Reality (Warning)"}),"\n",(0,s.jsxs)(n.admonition,{title:"Service Timeouts",type:"warning",children:[(0,s.jsx)(n.p,{children:"Services can hang if the server crashes. Always use timeouts:"}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"future = client.call_async(request)\r\nrclpy.spin_until_future_complete(self, future, timeout_sec=5.0)\r\nif not future.done():\r\n    self.get_logger().error('Service call timed out!')\n"})})]}),"\n",(0,s.jsx)(n.admonition,{title:"Action Cancellation",type:"danger",children:(0,s.jsx)(n.p,{children:"Always implement proper cancellation handling. A robot that can't stop is dangerous!"})}),"\n",(0,s.jsx)(n.h2,{id:"assessment",children:"Assessment"}),"\n",(0,s.jsx)(n.h3,{id:"recall",children:"Recall"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"When should you use a service vs. a topic?"}),"\n",(0,s.jsx)(n.li,{children:"What are the three components of an action (goal, feedback, result)?"}),"\n",(0,s.jsx)(n.li,{children:"How do you handle service timeouts?"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"apply",children:"Apply"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Create a service that returns the robot's battery percentage."}),"\n",(0,s.jsx)(n.li,{children:'Implement an action server for a "pick and place" task with progress feedback.'}),"\n",(0,s.jsx)(n.li,{children:"Write a client that cancels navigation if battery drops below 20%."}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"analyze",children:"Analyze"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Why are actions better than services for navigation tasks?"}),"\n",(0,s.jsx)(n.li,{children:"What happens if a service server crashes mid-request?"}),"\n",(0,s.jsx)(n.li,{children:"Design the communication architecture for a robot arm with 6 joints."}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453(e,n,r){r.d(n,{R:()=>i,x:()=>a});var t=r(6540);const s={},o=t.createContext(s);function i(e){const n=t.useContext(o);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);